<!DOCTYPE HTML>
<!--
	Phantom by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>WTX - What Today XP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Header -->
			<header id="header">
				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span>
				</a>
			</header>

			<div id="main">
				<header>
					<h1>WHAT TODAY XP</h1>
					<h2>Your Daily Progress Card</h2>
					<p>게임처럼 재미있는 하루를 플레이</p>
				</header>

				<div style="height: 50px;"></div>
				<!-- Main Content -->
				<div class="features">
					<div class="feature-item">
						<div class="feature-text">
							<h3>게임에 쏟은 시간 반만큼만</h3>
							<p>내가 게임하는 시간과 할 수 있는 것들</p>
						</div>
						<img src="/images/placeholder-image1.png" alt="Feature 1" />
					</div>
					<div class="feature-item">
						<img src="/images/placeholder-image2.png" alt="Feature 2" />
						<div class="feature-text">
							<h3>재미가 없는데 왜 해?</h3>
							<p>매일 점수를 받아 레벨 업</p>
						</div>
					</div>
					<div class="feature-item">
						<div class="feature-text">
							<h3>누가 알아주지도 않는데?</h3>
							<p>랭킹, 통계를 통해 내 위치를 확인</p>
						</div>
						<img src="/images/placeholder-image3.png" alt="Feature 3" />
					</div>
					<div class="feature-item">
						<img src="/images/placeholder-image4.png" alt="Feature 4" />
						<div class="feature-text">
							<h3>이게 끝이야?</h3>
							<p>업적, 공략 게시판, 파티 등</p>
						</div>
					</div>
				</div>							

				<div style="height: 50px;"></div>

				<div class="form-section">
					<form id="score-form" action="generic.html" method="get">
						<h2>What Today XP?</h2>
						<p>하루를 스스로 평가하고, 오늘의 경험치를 받아보세요</p>
						<label for="intelligence">읽은 글의 페이지 수(책이 아닌 뉴스 등의 매체 포함):</label>
						<input type="number" id="intelligence" name="intelligence" min="0" max="1000" required>
						<label for="strength">운동 시간(분 단위로 적어주세요):</label>
						<input type="number" id="strength" name="strength" min="0" max="1000" required>
						<label for="cultural">유튜브 본 시간(분 단위로 적어주세요):</label>
						<input type="number" id="cultural" name="cultural" min="0" max="1000" required>
						<label for="planning">계획 세우는 데 쓴 시간(메뉴 고르기, 출퇴근 교통편 정하기 포함/분 단위로 적어주세요):</label>
						<input type="number" id="planning" name="planning" min="0" max="1000" required>
						<label for="execution">하기 싫었지만 한 일의 개수(일어나기, 설거지하기, 청소하기 등):</label>
						<input type="number" id="execution" name="execution" min="0" max="1000" required>
						<label for="network">연락, 만남에 사용한 시간(대략/분 단위로 적어주세요):</label>
						<input type="number" id="network" name="network" min="0" max="1000" required>
						<button type="submit">결과 확인</button>
					</form>
				</div>

				<div style="height: 50px;"></div>

				<div class="notification-section">
					<p class="title">WHAT TODAY XP는 아직 개발 중인 서비스입니다.</p>
					<p>이메일을 남겨주시면 서비스가 런칭될 때 알림을 드리겠습니다.</p>
					<input id="submit-email" type="email" placeholder="알림을 받으실 이메일" />
					<p>WTX 서비스에 대한 조언이나 충고를 남겨주세요</p>
					<p>의견을 남겨주신 모든분들께, 런칭 시 세 달간 무료로 프리미엄 혜택을 제공해드립니다.</p>
					<textarea id="submit-advice" name="Text1" placeholder="서비스에 대한 조언이나 충고를 남겨주세요 (선택)"></textarea>
					<button id="submit">지금 제출!</button>
				
					<div id="popup" style="display:none;">
						<h1 style="color:#181818;">소중한 의견 감사합니다</h1>
						<p style="color:#181818">런칭 시 메일을 보내드리겠습니다</p>
					</div>
				</div>
				<!-- <center>
					<button id="API-BUTTON">이것은 테스트입니다. </button>
					<p id="API-RESULT">이곳은 응답입니다.</p>
				</center> -->
			</div>

			<!-- Footer -->
			<footer id="footer">
				<div class="inner">
					<section>
						<h2>Contact</h2>
						<p>Email: wkdrns717@gmail.com</p>
						<p>
							<a href="https://github.com/Lee-Yongju" class="icon brands style2 fa-github">
								GitHub
							</a>
						</p>
					</section>
					<div class="copyright">
						<p>&copy; WHAT TODAY XP. All rights reserved</p>
					</div>
				</div>
			</footer>
		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

			<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
			<link href="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.css" rel="stylesheet">
			<script src="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.js"></script>
    		<link href="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.css" rel="stylesheet" type="text/css" />

			<script type="application/javascript">
				var ip = "null";
				function getIP(json) {
					console.log(json);
					try {
						ip = json.ip;
					} catch (e) {
						ip = 'unknown';
					}
					return;
				}
			</script>
			<script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>

			<script>
				// 쿠키에서 값을 가져오는 함수
				function getCookieValue(name) {
					const value = "; " + document.cookie;
					const parts = value.split("; " + name + "=");
					if (parts.length === 2) {
						return parts.pop().split(";").shift();
					}
				}

				// 쿠키에 값을 저장하는 함수
				function setCookieValue(name, value, days) {
					let expires = "";
					if (days) {
						const date = new Date();
						date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
						expires = "; expires=" + date.toUTCString();
					}
					document.cookie = name + "=" + (value || "") + expires + "; path=/";
				}

				function getUVfromCookie() {
					// 6자리 임의의 문자열 생성
					const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
					// 쿠키에서 기존 해시 값을 가져옴
					const existingHash = getCookieValue("user");
					// 기존 해시 값이 없으면, 새로운 해시 값을 쿠키에 저장
					if (!existingHash) {
						setCookieValue("user", hash, 180); // 쿠키 만료일은 6개월 
						return hash;
					} else {
						// 기존 해시 값이 있으면, 기존 값을 반환
						return existingHash;
					}
				}
				
				// Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
				function padValue(value) {
					return (value < 10) ? "0" + value : value;
				}

				function getTimeStamp() {
					const date = new Date();

					const year = date.getFullYear();
					const month = date.getMonth() + 1;
					const day = date.getDate();
					const hours = date.getHours();
					const minutes = date.getMinutes();
					const seconds = date.getSeconds();

					const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

					return formattedDate;
				}

				var queryString = location.search;
				const urlParams = new URLSearchParams(queryString);
				const utm = urlParams.get("utm")

				var mobile = 'desktop';
				if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
					// true for mobile device
					mobile = 'mobile';
				}

				var data = JSON.stringify(
					{"id": getUVfromCookie(),
					"landingUrl":window.location.href, 
					"ip":ip, 
					"referer":document.referrer,
					"time_stamp":getTimeStamp(), 
					"utm":utm,
					"device":mobile}
				);

				$(document).ready(function () {

					addrScript = 'https://script.google.com/macros/s/AKfycbyubsJuWVuZbhVgX9j4cnqvc_UoFeiaScHrDWmqcDMI9XqUfEBhXuIWuTHb3RtPFHcmVw/exec';

					$.ajax({
					    url: addrScript+'?action=insert&table=visitors&data='+data,
					    dataType: 'jsonp',
					    success: function (data) {
						console.log('성공 - ', JSON.stringify(data));
					    },
					    error: function (xhr) {
						console.log('실패 - ', JSON.stringify(xhr));
					    }
					});

					//axios.get(addrScript+'?action=insert&table=visitors&data='+data)
				    //.then(response => {
					//	console.log(JSON.stringify(response));
				    //})
					axios.get(addrScript+'?action=insert&table=visitors&data='+data)
				    .then(response => {
							console.log(JSON.stringify(response));
					})
					.catch(error => {
						if (error.response) {
							// 서버가 2xx 범위를 벗어난 상태 코드로 응답한 경우
							console.log(error.response.data);
							console.log(error.response.status);
							console.log(error.response.headers);
						} else if (error.request) {
							// 요청이 전송되었지만 응답을 받지 못한 경우
							console.log(error.request);
						} else {
							// 요청 설정 중에 오류가 발생한 경우
							console.log('Error', error.message);
						}
						console.log(error.config);
					});
				});



				$("#submit").on("click", function () {
					$.busyLoadFull("show");

					const email = $("#submit-email").val();
					const advice = $("#submit-advice").val();
		    
					function validateEmail(email) {
					    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
					    return re.test(email);
					}
		    
					if (email == '' || !validateEmail(email)) {
						alert("이메일이 유효하지 않아 알림을 드릴 수가 없습니다. ");
						$.busyLoadFull("hide");
					    return;
					}
		    
					var finalData = JSON.stringify({
					    "id": getUVfromCookie(),
					    "email": email,
					    "advice": advice
					})
		    
					axios.get(addrScript+'?action=insert&table=registration&data=' + finalData)
					    .then(response => {
						console.log(response.data.data);
						//alert(JSON.stringify(response));
						$.busyLoadFull("hide");
						$.fn.simplePopup({ type: "html", htmlSelector: "#popup" });
						$('#submit-email').val('');
						$('#submit-advice').val('');
					    })
				});
			</script>

	</body>
</html>